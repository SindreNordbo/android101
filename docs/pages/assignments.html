---
layout: default
title: Assignments
---

You will create a twitter-like app that communicates with an HTTP REST API for viewing and creating messages. It is up to you whether you want to focus on GUI polish and interaction, or implement all the functionality in the API.

<h3>API</h3>

<p>The server is at: <a href="http://mobile-course.herokuapp.com">
		http://mobile-course.herokuapp.com</a></p>

<p>
It hosts the following JSON endpoints:
<table class="table table-bordered">
	<thead>
		<tr>
			<th>URL</th>
			<th>HTTP verb</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody>
	<tr>
		<td><a href="http://mobile-course.herokuapp.com/message">http://mobile-course.herokuapp.com/message</a></td>
		<td>GET</td>
		<td>Retrieves all messages</td>
	</tr>
	<tr>
		<td><a href="http://mobile-course.herokuapp.com/message">http://mobile-course.herokuapp.com/message</a></td>
		<td>POST</td>
		<td>Creates a message(see JSON example below)</td>
	</tr>
	<tr>
		<td><a href="http://mobile-course.herokuapp.com/:id">http://mobile-course.herokuapp.com/message/:id</a></td>
		<td>PUT</td>
		<td>Updates a message</td>
	</tr>
	<tr>
		<td><a href="http://mobile-course.herokuapp.com/:id">http://mobile-course.herokuapp.com/message/:id</a></td>
		<td>DELETE</td>
		<td>Deletes a message</td>
	</tr>
	</tbody>
</table>

<h3>POST example</h3>

<div class="highlight"><pre><code class="javascript"><span class="p">{</span>
	<span class="c1">//Date is not required, but can be fun to manipulate.;)</span>
	<span class="s2">&quot;from&quot;</span><span class="o">:</span><span class="s2">&quot;hinderberg&quot;</span><span class="p">,</span>
	<span class="s2">&quot;message&quot;</span><span class="o">:</span><span class="s2">&quot;You'll Never Walk Alone!:)&quot;</span><span class="p">,</span>
	<span class="s2">&quot;image&quot;</span><span class="o">:</span><span class="s2">&quot;www.url.to.image&quot;</span><span class="p">,</span>
	<span class="s2">&quot;date&quot;</span><span class="o">:</span><span class="s2">&quot;2012-10-18T17:43:48.011Z&quot;</span> 

<span class="p">}</span>
</code></pre></div>

<h3> Retrofit </h3>
If you want to use retrofit, you will need the following gradle dependency:
<code>compile 'com.squareup.retrofit:retrofit:1.6.1'</code>.

If you want to do things manually and need a framework for JSON-parsing, we suggest using Gson.

<h3> Helper class for uploading photo to Imgur</h3>
{% highlight java %}
package no.bekk.android.messages.imgur;

import android.app.Activity;
import android.graphics.Bitmap;
import android.net.Uri;
import android.os.AsyncTask;
import android.util.Log;
import org.json.JSONObject;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Scanner;

public abstract class Upload extends AsyncTask<Void, Void, String> {

    private static final String TAG = Upload.class.getSimpleName();

    private static final String UPLOAD_URL = "https://api.imgur.com/3/image";

    private Activity mActivity;
    private Bitmap bitmap;
    public Upload(Bitmap bitmap, Activity activity) {
        this.bitmap = bitmap;
        this.mActivity = activity;
    }

    @Override
    protected String doInBackground(Void... params) {
        ByteArrayOutputStream stream = new ByteArrayOutputStream();
        bitmap.compress(Bitmap.CompressFormat.JPEG, 100, stream);
        InputStream imageIn = new ByteArrayInputStream(stream.toByteArray());

        HttpURLConnection conn = null;
        InputStream responseIn = null;

        try {
            conn = (HttpURLConnection) new URL(UPLOAD_URL).openConnection();
            conn.setRequestProperty("Authorization", "Client-ID " + "7362bd404ecd0c1");
            conn.setDoOutput(true);

            OutputStream out = conn.getOutputStream();
            copy(imageIn, out);
            out.flush();
            out.close();

            if (conn.getResponseCode() == HttpURLConnection.HTTP_OK) {
                responseIn = conn.getInputStream();
                return onInput(responseIn);
            }
            else {
                Log.i(TAG, "responseCode=" + conn.getResponseCode());
                responseIn = conn.getErrorStream();
                StringBuilder sb = new StringBuilder();
                Scanner scanner = new Scanner(responseIn);
                while (scanner.hasNext()) {
                    sb.append(scanner.next());
                }
                Log.i(TAG, "error response: " + sb.toString());
                return null;
            }
        } catch (Exception ex) {
            Log.e(TAG, "Error during POST", ex);
            return null;
        } finally {
            try {
                responseIn.close();
            } catch (Exception ignore) {}
            try {
                conn.disconnect();
            } catch (Exception ignore) {}
            try {
                imageIn.close();
            } catch (Exception ignore) {}
        }
    }

    private static int copy(InputStream input, OutputStream output) throws IOException {
        byte[] buffer = new byte[8192];
        int count = 0;
        int n = 0;
        while (-1 != (n = input.read(buffer))) {
            output.write(buffer, 0, n);
            count += n;
        }
        return count;
    }

    protected String onInput(InputStream in) throws Exception {
        StringBuilder sb = new StringBuilder();
        Scanner scanner = new Scanner(in);
        while (scanner.hasNext()) {
            sb.append(scanner.next());
        }

        JSONObject root = new JSONObject(sb.toString());
        String id = root.getJSONObject("data").getString("id");
        String deletehash = root.getJSONObject("data").getString("deletehash");

        Log.i(TAG, "new imgur url: http://imgur.com/" + id + " (delete hash: " + deletehash + ")");
        return id;
    }

}
{% endhighlight %}

<h3> Tips for downloading images </h3>

compile 'com.nostra13.universalimageloader:universal-image-loader:1.9.3'
