<!DOCTYPE html>
<html lang="nb">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Lists and RecyclerView</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/android101/css/syntax.css">
        <link href="/android101/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link rel="stylesheet" href="/android101/css/main.css">
        <script src="/android101/js/jquery.min.js"></script>
        <script src="/android101/js/bootstrap.min.js"></script>

    </head>
    <body>
      <div class="container-fluid main">
        <div class="row-fluid">
          <div class="span8">
            <h1 class="page-header">Lists and RecyclerView</h1>
            When we work with lists in Android, we first create a model to hold the data we want to display:
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">DateTime</span> <span class="n">date</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">from</span><span class="o">,</span> <span class="n">message</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Message</span><span class="o">(</span><span class="n">String</span> <span class="n">from</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">DateTime</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">from</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFrom</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">from</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">DateTime</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">date</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
Then, we create a layout xml file used for each message in the list. We place this file in
<code>res/layout/item_message.xml</code>.

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

    <span class="nt">&lt;RelativeLayout</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
            <span class="na">android:padding=</span><span class="s">&quot;10dp&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/tvFrom&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;From:&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/tvMessage&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;Message body&quot;</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/tvDate&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;Timestamp&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/RelativeLayout&gt;</span></code></pre></div>
For displaying data in lists, we use what is called a <code>RecyclerView</code>. A RecyclerView is a component for handling data sets, and it has two key concepts for rendering these in list form:
<ul>
   <li>We use an <code>Adapter</code> to bind the view elements in the RecyclerView to the data set we want to display.</li>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">ppublic</span> <span class="kd">class</span> <span class="nc">MessagesAdapter</span> <span class="kd">extends</span> <span class="n">RecyclerView</span><span class="o">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="n">MessagesAdapter</span><span class="o">.</span><span class="na">MessagesViewHolder</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TapDelegate</span> <span class="n">tapDelegate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MessagesAdapter</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">,</span> <span class="n">TapDelegate</span> <span class="n">tapDelegate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">inflater</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">messages</span> <span class="o">=</span> <span class="n">messages</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tapDelegate</span> <span class="o">=</span> <span class="n">tapDelegate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">MessagesViewHolder</span> <span class="nf">onCreateViewHolder</span><span class="o">(</span><span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">viewType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">itemMessage</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item_message</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">MessagesViewHolder</span> <span class="n">messagesViewHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MessagesViewHolder</span><span class="o">(</span><span class="n">itemMessage</span><span class="o">,</span> <span class="n">tapDelegate</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">messagesViewHolder</span><span class="o">.</span><span class="na">view</span> <span class="o">=</span> <span class="n">itemMessage</span><span class="o">;</span>
        <span class="n">messagesViewHolder</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">itemMessage</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvFrom</span><span class="o">);</span>
        <span class="n">messagesViewHolder</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">itemMessage</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvMessage</span><span class="o">);</span>
        <span class="n">messagesViewHolder</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">itemMessage</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tvDate</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">messagesViewHolder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBindViewHolder</span><span class="o">(</span><span class="n">MessagesViewHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>

        <span class="n">holder</span><span class="o">.</span><span class="na">from</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getFrom</span><span class="o">());</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">message</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">date</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getDateTimeString</span><span class="o">());</span>
        <span class="n">holder</span><span class="o">.</span><span class="na">position</span> <span class="o">=</span> <span class="n">position</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getItemCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">messages</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MessagesViewHolder</span> <span class="kd">extends</span> <span class="n">RecyclerView</span><span class="o">.</span><span class="na">ViewHolder</span> <span class="kd">implements</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnLongClickListener</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">view</span><span class="o">;</span>
        <span class="n">TextView</span> <span class="n">from</span><span class="o">,</span> <span class="n">message</span><span class="o">,</span> <span class="n">date</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">position</span><span class="o">;</span>
        <span class="n">TapDelegate</span> <span class="n">tapDelegate</span><span class="o">;</span>
        <span class="n">LongTapDelegate</span> <span class="n">longTapDelegate</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">MessagesViewHolder</span><span class="o">(</span><span class="n">View</span> <span class="n">itemView</span><span class="o">,</span> <span class="n">TapDelegate</span> <span class="n">tapDelegate</span><span class="o">,</span> <span class="n">LongTapDelegate</span> <span class="n">longTapDelegate</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">itemView</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">tapDelegate</span> <span class="o">=</span> <span class="n">tapDelegate</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">longTapDelegate</span> <span class="o">=</span> <span class="n">longTapDelegate</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">view</span> <span class="o">=</span> <span class="n">itemView</span><span class="o">;</span>
            <span class="n">view</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">tapDelegate</span><span class="o">.</span><span class="na">tappedItemAtPosition</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onLongClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">longTapDelegate</span><span class="o">.</span><span class="na">longTappedItemAtPosition</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<li>We also need a <code>LayoutManager</code> for positioning the views inside the RecyclerView. For lists, the <code>LinearLayoutManager</code> is the chosen layout manager, which can display items either vertically or horizontally. The LayoutManager will also handle the reuse of item views that are no longer visible, in order to minimize view lookups.</li>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Layoutmanagereksempel</span></code></pre></div>

</ul>
In the activity that displays the list, we get the <code>ListView</code> from the activity layout using the id <code>R.id.lvMessages</code> and set it to use our adapter. All changes made to the messages list via the adapter will now be reflected in the GUI.

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;();</span>
<span class="n">MessageAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MessageAdapter</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">messages</span><span class="o">);</span>
<span class="n">ListView</span> <span class="n">listView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">lvMessages</span><span class="o">);</span>
<span class="n">listView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span></code></pre></div>

          </div>
          <nav class="span4">
            <strong>Android</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
      <li class=""><a href="/android101/pages/android-app-structure-and-components.html">App Structure and Components</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/view-layout.html">View Layout</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/android101/pages/common-view-controls.html">Common View Controls</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class="active"><a href="/android101/pages/list-recycler-view.html">Lists and RecyclerView</a></li>
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>
            
            <strong>Network Communication</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/working-in-the-background.html">Working In the Background</a></li>
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/retrofit.html">Consume REST APIs with Retrofit</a></li>
    
  
    
  
    
  

  
</ul>

            <strong>Workshop</strong>
            
<ul class="nav nav-pills nav-stacked">

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/prerequisites.html">Prerequisites</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/android101/pages/assignments.html">Assignments</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/android101/pages/manuscript.html">Manuscript</a></li>
    
  
    
  
    
  
    
  
    
  

  
</ul>
          </nav>
        </div>
      </div>

    </body>
</html>
